<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–≤—Ç–æ—Å—Ç–æ–ø–æ–º –ø–æ –∫—Ä–∞—é - Minecraft –ø—Ä–æ–µ–∫—Ç</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #f0f0f0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
            min-height: 100vh;
        }
        
        .header {
            background: linear-gradient(135deg, #5b7c3a 0%, #3b5228 100%);
            border: 5px solid #8b4513;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #8b4513, #ffd700, #8b4513);
        }
        
        h1 {
            color: white;
            text-shadow: 3px 3px 0 #000;
            font-size: 2.5rem;
            margin: 0;
        }
        
        .subtitle {
            color: #d0ffb0;
            font-size: 1.2rem;
            margin-top: 10px;
        }
        
        .section {
            background: #3a2c1d;
            border: 3px solid #654321;
            border-radius: 10px;
            margin: 20px 0;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .question {
            background: #8b4513;
            color: white;
            padding: 18px;
            cursor: pointer;
            font-size: 1.2rem;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
            border-bottom: 2px solid #654321;
        }
        
        .question:hover {
            background: #a0522d;
        }
        
        .question::after {
            content: "‚ñº";
            transition: transform 0.3s;
        }
        
        .question.active::after {
            transform: rotate(180deg);
        }
        
        .answer {
            padding: 20px;
            background: #2a1f14;
            display: none;
            animation: fadeIn 0.3s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .goal-list {
            list-style: none;
            padding: 0;
        }
        
        .goal-list li {
            padding: 10px 0;
            border-bottom: 1px dashed #5a4a3a;
            position: relative;
            padding-left: 30px;
        }
        
        .goal-list li::before {
            content: "‚öîÔ∏è";
            position: absolute;
            left: 0;
        }
        
        .goal-list li:nth-child(2)::before { content: "üêâ"; }
        .goal-list li:nth-child(3)::before { content: "‚õèÔ∏è"; }
        .goal-list li:nth-child(4)::before { content: "üè≠"; }
        .goal-list li:nth-child(5)::before { content: "üõ°Ô∏è"; }
        .goal-list li:nth-child(6)::before { content: "üèòÔ∏è"; }
        
        .auth-buttons {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 100;
        }
        
        button {
            background: #3d85c6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            border: 2px solid #1f3d7a;
        }
        
        button:hover {
            background: #2b6cb0;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(43, 108, 176, 0.4);
        }
        
        .logout-btn {
            background: #e53e3e;
            border-color: #c53030;
        }
        
        .logout-btn:hover {
            background: #c53030;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: #2d2d2d;
            padding: 30px;
            border-radius: 15px;
            border: 3px solid #5b7c3a;
            width: 90%;
            max-width: 400px;
            position: relative;
        }
        
        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #5b7c3a;
        }
        
        .tab {
            flex: 1;
            padding: 15px;
            background: none;
            border: none;
            color: #aaa;
            cursor: pointer;
            font-weight: bold;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            color: white;
            border-bottom-color: #5b7c3a;
        }
        
        input, textarea {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            background: #3a3a3a;
            border: 2px solid #555;
            border-radius: 8px;
            color: white;
            font-size: 16px;
            box-sizing: border-box;
        }
        
        input:focus, textarea:focus {
            outline: none;
            border-color: #5b7c3a;
        }
        
        .error {
            color: #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            display: none;
        }
        
        .success {
            color: #51cf66;
            background: rgba(81, 207, 102, 0.1);
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            display: none;
        }
        
        .comment-section {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 2px dashed #5a4a3a;
        }
        
        .comment {
            background: #3a3a3a;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #5b7c3a;
        }
        
        .comment-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }
        
        .comment-author {
            color: #5b7c3a;
            font-weight: bold;
        }
        
        .comment-time {
            color: #888;
        }
        
        .vote-buttons {
            margin-top: 10px;
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .vote-btn {
            background: none;
            border: none;
            padding: 5px;
            cursor: pointer;
            font-size: 1.2rem;
        }
        
        .like-btn { color: #51cf66; }
        .dislike-btn { color: #ff6b6b; }
        
        .poll-section {
            margin-top: 40px;
            background: #2a2a2a;
            padding: 20px;
            border-radius: 10px;
            border: 3px solid #3d85c6;
        }
        
        .poll-option {
            background: #3a3a3a;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .poll-option:hover {
            background: #4a4a4a;
        }
        
        .poll-option.selected {
            background: #2b6cb0;
            border-left: 4px solid #3d85c6;
        }
        
        .user-info {
            position: fixed;
            top: 20px;
            left: 20px;
            background: #3a2c1d;
            padding: 10px 20px;
            border-radius: 8px;
            border: 2px solid #5b7c3a;
            display: none;
            z-index: 100;
        }
        
        .username {
            color: #ffd700;
            font-weight: bold;
        }
        
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .auth-buttons {
                position: static;
                margin-bottom: 20px;
                justify-content: center;
            }
            
            .user-info {
                position: static;
                margin: 10px 0;
            }
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #888;
        }
        
        .loading::after {
            content: "...";
            animation: dots 1.5s infinite;
        }
        
        @keyframes dots {
            0%, 20% { content: "."; }
            40% { content: ".."; }
            60%, 100% { content: "..."; }
        }
    </style>
</head>
<body>
    <!-- –ö–Ω–æ–ø–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
    <div class="auth-buttons">
        <button onclick="showAuthModal()" id="loginBtn">–í–æ–π—Ç–∏</button>
        <button onclick="showAuthModal('register')" id="registerBtn">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
        <button onclick="logout()" class="logout-btn" id="logoutBtn" style="display: none;">–í—ã–π—Ç–∏</button>
    </div>
    
    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ -->
    <div class="user-info" id="userInfo">
        –ü—Ä–∏–≤–µ—Ç, <span class="username" id="usernameSpan"></span>!
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
    <div class="modal" id="authModal">
        <div class="modal-content">
            <button class="close-modal" onclick="hideAuthModal()">√ó</button>
            <div class="tabs">
                <button class="tab active" onclick="switchTab('login')">–í—Ö–æ–¥</button>
                <button class="tab" onclick="switchTab('register')">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
            </div>
            
            <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
            <div id="loginForm">
                <div class="error" id="loginError"></div>
                <input type="email" id="loginEmail" placeholder="Email">
                <input type="password" id="loginPassword" placeholder="–ü–∞—Ä–æ–ª—å">
                <button onclick="login()" style="width: 100%;">–í–æ–π—Ç–∏</button>
            </div>
            
            <!-- –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
            <div id="registerForm" style="display: none;">
                <div class="error" id="registerError"></div>
                <div class="success" id="registerSuccess"></div>
                <input type="text" id="registerUsername" placeholder="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
                <input type="email" id="registerEmail" placeholder="Email">
                <input type="password" id="registerPassword" placeholder="–ü–∞—Ä–æ–ª—å (–º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤)">
                <button onclick="register()" style="width: 100%;">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
            </div>
        </div>
    </div>
    
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="header">
        <h1>üî® –ê–≤—Ç–æ—Å—Ç–æ–ø–æ–º –ø–æ –∫—Ä–∞—é ‚öîÔ∏è</h1>
        <div class="subtitle">–ú–æ–π Minecraft –ø—Ä–æ–µ–∫—Ç</div>
    </div>
    
    <!-- –°–µ–∫—Ü–∏—è 1: –ß—Ç–æ —Ç–∞–∫–æ–µ –ø—Ä–æ–µ–∫—Ç -->
    <div class="section">
        <div class="question" onclick="toggleAnswer(1)">
            –ß—Ç–æ —Ç–∞–∫–æ–µ ¬´–ê–≤—Ç–æ—Å—Ç–æ–ø–æ–º –ø–æ –∫—Ä–∞—é¬ª?
        </div>
        <div class="answer" id="answer1">
            <p>"–ê–≤—Ç–æ—Å—Ç–æ–ø–æ–º –ø–æ –∫—Ä–∞—é" ‚Äî —ç—Ç–æ –ø—Ä–æ–µ–∫—Ç –≤ –ú–∞–π–Ω–∫—Ä–∞—Ñ—Ç–µ –≥–¥–µ —è –ø—Ä–æ—Å—Ç–æ —Å—Ç—Ä–æ—é –¥–æ–º–∞ –∏ –ø—Ä–æ—Ö–æ–∂—É –≤–µ—Å—å –º–∞–π–Ω–∫—Ä–∞—Ñ—Ç.</p>
            
            <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è —Å–µ–∫—Ü–∏–∏ 1 -->
            <div class="comment-section">
                <h3>üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h3>
                <div id="comments1" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤</div>
                <textarea id="commentInput1" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." rows="2"></textarea>
                <button onclick="addComment('what')">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </div>
        </div>
    </div>
    
    <!-- –°–µ–∫—Ü–∏—è 2: –¶–µ–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞ -->
    <div class="section">
        <div class="question" onclick="toggleAnswer(2)">
            –ö–∞–∫–∏–µ —Ü–µ–ª–∏ —É –ø—Ä–æ–µ–∫—Ç–∞?
        </div>
        <div class="answer" id="answer2">
            <ul class="goal-list">
                <li>–ü–æ—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é –¥–µ—Ä–µ–≤–Ω—é —Å –∂–∏—Ç–µ–ª—è–º–∏ (–¥–∞—Ç—å –≤—Å–µ–º –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏)</li>
                <li>–£–±–∏—Ç—å –≠–Ω–¥–µ—Ä –î—Ä–∞–∫–æ–Ω–∞</li>
                <li>–ü–æ–ª—É—á–∏—Ç—å –ª—É—á—à–∏–π –Ω–µ–∑–µ—Ä–∏—Ç–æ–≤—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø–æ—á—Ç–∏ —Å–æ –≤—Å–µ–º–∏ —á–∞—Ä–∞–º–∏</li>
                <li>–ü–æ—Å—Ç—Ä–æ–∏—Ç—å –∫–∞–∫ –º–∏–Ω–∏–º—É–º 3 –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–µ—Ä–º—ã</li>
                <li>–ü–æ–ª—É—á–∏—Ç—å –ª—É—á—à–∏–π –Ω–µ–∑–µ—Ä–∏—Ç–æ–≤—ã–π —Å–µ—Ç –±—Ä–æ–Ω–∏</li>
                <li>–ü–æ—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –≥–æ—Ä–æ–¥</li>
            </ul>
            
            <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è —Å–µ–∫—Ü–∏–∏ 2 -->
            <div class="comment-section">
                <h3>üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h3>
                <div id="comments2" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤</div>
                <textarea id="commentInput2" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." rows="2"></textarea>
                <button onclick="addComment('goals')">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </div>
        </div>
    </div>
    
    <!-- –°–µ–∫—Ü–∏—è 3: –ü—Ä–æ–≥—Ä–µ—Å—Å -->
    <div class="section">
        <div class="question" onclick="toggleAnswer(3)">
            –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ?
        </div>
        <div class="answer" id="answer3">
            <p>üü¢ –ü–æ—Å—Ç—Ä–æ–µ–Ω–∞ –ø–µ—Ä–≤–∞—è —Ö–∏–∂–∏–Ω–∞</p>
            <p>üü¢ –î–æ–±—ã—Ç—ã –∞–ª–º–∞–∑—ã</p>
            <p>üü° –ù–∞—á–∞—Ç–æ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ —Ñ–µ—Ä–º—ã</p>
            <p>üî¥ –ï—â–µ –Ω–µ —É–±–∏—Ç –≠–Ω–¥–µ—Ä –î—Ä–∞–∫–æ–Ω</p>
            
            <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è —Å–µ–∫—Ü–∏–∏ 3 -->
            <div class="comment-section">
                <h3>üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h3>
                <div id="comments3" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤</div>
                <textarea id="commentInput3" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." rows="2"></textarea>
                <button onclick="addComment('progress')">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </div>
        </div>
    </div>
    
    <!-- –°–µ–∫—Ü–∏—è 4: –°–∫—Ä–∏–Ω—à–æ—Ç—ã -->
    <div class="section">
        <div class="question" onclick="toggleAnswer(4)">
            –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç—ã
        </div>
        <div class="answer" id="answer4">
            <p>üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç—ã —Å–∫–æ—Ä–æ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å!</p>
            
            <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è —Å–µ–∫—Ü–∏–∏ 4 -->
            <div class="comment-section">
                <h3>üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h3>
                <div id="comments4" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤</div>
                <textarea id="commentInput4" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." rows="2"></textarea>
                <button onclick="addComment('screenshots')">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </div>
        </div>
    </div>
    
    <!-- –†–∞–∑–¥–µ–ª –æ–ø—Ä–æ—Å–æ–≤ -->
    <div class="poll-section">
        <h2>üìä –û–ø—Ä–æ—Å—ã —Å–æ–æ–±—â–µ—Å—Ç–≤–∞</h2>
        <button onclick="createPollModal()" id="createPollBtn" style="display: none;">–°–æ–∑–¥–∞—Ç—å –æ–ø—Ä–æ—Å</button>
        <div id="pollsContainer" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –æ–ø—Ä–æ—Å–æ–≤</div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –æ–ø—Ä–æ—Å–∞ -->
    <div class="modal" id="pollModal">
        <div class="modal-content">
            <button class="close-modal" onclick="hidePollModal()">√ó</button>
            <h3>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –æ–ø—Ä–æ—Å</h3>
            <div class="error" id="pollError"></div>
            <input type="text" id="pollQuestion" placeholder="–í–æ–ø—Ä–æ—Å –æ–ø—Ä–æ—Å–∞">
            <div id="pollOptions">
                <input type="text" placeholder="–í–∞—Ä–∏–∞–Ω—Ç 1">
                <input type="text" placeholder="–í–∞—Ä–∏–∞–Ω—Ç 2">
            </div>
            <button onclick="addPollOption()" style="background: #666; margin-top: 10px;">+ –î–æ–±–∞–≤–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç</button>
            <button onclick="createPoll()" style="width: 100%; margin-top: 20px;">–°–æ–∑–¥–∞—Ç—å –æ–ø—Ä–æ—Å</button>
        </div>
    </div>
    
    <script>
        // üîß –ù–ê–°–¢–†–û–ô–ö–ò SUPABASE (—Ç–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ —É–∂–µ –∑–¥–µ—Å—å)
        const SUPABASE_URL = 'https://vpgzjvkrqgvcewjhxuay.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_q-PJ_EmdubLQ9o46S1tVDg_XH1ucyHE';
        
        // üì¶ –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø SUPABASE
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        
        // üë§ –¢–ï–ö–£–©–ò–ô –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨
        let currentUser = null;
        
        // üöÄ –ó–ê–ì–†–£–ó–ö–ê –°–ê–ô–¢–ê
        document.addEventListener('DOMContentLoaded', async () => {
            await checkAuth();
            loadAllComments();
            loadPolls();
        });
        
        // üîÑ –ü–†–û–í–ï–†–ö–ê –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò
        async function checkAuth() {
            const { data: { user } } = await supabase.auth.getUser();
            
            if (user) {
                currentUser = user;
                showUserInfo(user);
            } else {
                showGuestView();
            }
        }
        
        // üë§ –ü–û–ö–ê–ó–ê–¢–¨ –ò–ù–§–û –û –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï
        async function showUserInfo(user) {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –≤—ã—Ö–æ–¥–∞
            document.getElementById('logoutBtn').style.display = 'block';
            document.getElementById('loginBtn').style.display = 'none';
            document.getElementById('registerBtn').style.display = 'none';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Å–æ–∑–¥–∞–Ω–∏—è –æ–ø—Ä–æ—Å–∞
            document.getElementById('createPollBtn').style.display = 'block';
            
            // –ü–æ–ª—É—á–∞–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const { data: profile } = await supabase
                .from('profiles')
                .select('username')
                .eq('id', user.id)
                .single();
            
            if (profile) {
                document.getElementById('usernameSpan').textContent = profile.username;
                document.getElementById('userInfo').style.display = 'block';
            }
        }
        
        // üé≠ –ü–û–ö–ê–ó–ê–¢–¨ –í–ò–î –î–õ–Ø –ì–û–°–¢–Ø
        function showGuestView() {
            document.getElementById('logoutBtn').style.display = 'none';
            document.getElementById('loginBtn').style.display = 'block';
            document.getElementById('registerBtn').style.display = 'block';
            document.getElementById('createPollBtn').style.display = 'none';
            document.getElementById('userInfo').style.display = 'none';
        }
        
        // üîì –í–•–û–î
        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const errorEl = document.getElementById('loginError');
            
            if (!email || !password) {
                errorEl.textContent = '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è';
                errorEl.style.display = 'block';
                return;
            }
            
            const { data, error } = await supabase.auth.signInWithPassword({
                email,
                password
            });
            
            if (error) {
                errorEl.textContent = error.message;
                errorEl.style.display = 'block';
            } else {
                hideAuthModal();
                location.reload();
            }
        }
        
        // üìù –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø
        async function register() {
            const username = document.getElementById('registerUsername').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const errorEl = document.getElementById('registerError');
            const successEl = document.getElementById('registerSuccess');
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞
            if (!username || !email || !password) {
                errorEl.textContent = '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è';
                errorEl.style.display = 'block';
                return;
            }
            
            if (password.length < 6) {
                errorEl.textContent = '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤';
                errorEl.style.display = 'block';
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–Ω—è—Ç –ª–∏ username
            const { data: existingUser } = await supabase
                .from('profiles')
                .select('username')
                .eq('username', username)
                .single();
            
            if (existingUser) {
                errorEl.textContent = '–≠—Ç–æ –∏–º—è —É–∂–µ –∑–∞–Ω—è—Ç–æ';
                errorEl.style.display = 'block';
                return;
            }
            
            // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º
            const { data, error } = await supabase.auth.signUp({
                email,
                password,
                options: {
                    data: { username }
                }
            });
            
            if (error) {
                errorEl.textContent = error.message;
                errorEl.style.display = 'block';
            } else {
                // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å
                await supabase.from('profiles').insert({
                    id: data.user.id,
                    username: username
                });
                
                successEl.textContent = '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—á—Ç—É.';
                successEl.style.display = 'block';
                errorEl.style.display = 'none';
                
                // –ß–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã –∑–∞–∫—Ä—ã–≤–∞–µ–º
                setTimeout(() => {
                    hideAuthModal();
                    showAuthModal();
                }, 3000);
            }
        }
        
        // üö™ –í–´–•–û–î
        async function logout() {
            await supabase.auth.signOut();
            location.reload();
        }
        
        // ü™ü –£–ü–†–ê–í–õ–ï–ù–ò–ï –ú–û–î–ê–õ–¨–ù–´–ú–ò –û–ö–ù–ê–ú–ò
        function showAuthModal(tab = 'login') {
            document.getElementById('authModal').style.display = 'flex';
            switchTab(tab);
        }
        
        function hideAuthModal() {
            document.getElementById('authModal').style.display = 'none';
            document.getElementById('loginError').style.display = 'none';
            document.getElementById('registerError').style.display = 'none';
            document.getElementById('registerSuccess').style.display = 'none';
            document.getElementById('loginEmail').value = '';
            document.getElementById('loginPassword').value = '';
            document.getElementById('registerUsername').value = '';
            document.getElementById('registerEmail').value = '';
            document.getElementById('registerPassword').value = '';
        }
        
        function switchTab(tab) {
            const loginTab = document.querySelectorAll('.tab')[0];
            const registerTab = document.querySelectorAll('.tab')[1];
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            
            if (tab === 'login') {
                loginTab.classList.add('active');
                registerTab.classList.remove('active');
                loginForm.style.display = 'block';
                registerForm.style.display = 'none';
            } else {
                loginTab.classList.remove('active');
                registerTab.classList.add('active');
                loginForm.style.display = 'none';
                registerForm.style.display = 'block';
            }
        }
        
        // üìñ –†–ê–°–ö–†–´–¢–ò–ï –°–ï–ö–¶–ò–ô
        function toggleAnswer(num) {
            const answer = document.getElementById(`answer${num}`);
            const question = document.querySelector(`#answer${num}`).previousElementSibling;
            
            if (answer.style.display === 'block') {
                answer.style.display = 'none';
                question.classList.remove('active');
            } else {
                answer.style.display = 'block';
                question.classList.add('active');
            }
        }
        
        // üí¨ –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ò
        async function loadAllComments() {
            for (let i = 1; i <= 4; i++) {
                await loadComments(i);
            }
        }
        
        async function loadComments(sectionNum) {
            const sectionMap = {
                1: 'what',
                2: 'goals', 
                3: 'progress',
                4: 'screenshots'
            };
            
            const section = sectionMap[sectionNum];
            const container = document.getElementById(`comments${sectionNum}`);
            
            const { data: comments, error } = await supabase
                .from('comments')
                .select('*, profiles(username)')
                .eq('section', section)
                .order('created_at', { ascending: false });
            
            if (error) {
                container.innerHTML = '<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤</div>';
                return;
            }
            
            if (!comments || comments.length === 0) {
                container.innerHTML = '<p>–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</p>';
                return;
            }
            
            let html = '';
            comments.forEach(comment => {
                const username = comment.profiles?.username || '–ê–Ω–æ–Ω–∏–º';
                const date = new Date(comment.created_at).toLocaleDateString('ru-RU');
                
                html += `
                    <div class="comment">
                        <div class="comment-header">
                            <span class="comment-author">${username}</span>
                            <span class="comment-time">${date}</span>
                        </div>
                        <p>${escapeHtml(comment.content)}</p>
                        <div class="vote-buttons">
                            <button class="vote-btn like-btn" onclick="voteComment('${comment.id}', 1)">üëç</button>
                            <span>${comment.likes || 0}</span>
                            <button class="vote-btn dislike-btn" onclick="voteComment('${comment.id}', -1)">üëé</button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        async function addComment(section) {
            if (!currentUser) {
                showAuthModal();
                return;
            }
            
            const sectionMap = {
                'what': 1,
                'goals': 2,
                'progress': 3,
                'screenshots': 4
            };
            
            const input = document.getElementById(`commentInput${sectionMap[section]}`);
            const content = input.value.trim();
            
            if (!content) {
                alert('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è');
                return;
            }
            
            // –ü–æ–ª—É—á–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å
            const { data: profile } = await supabase
                .from('profiles')
                .select('username')
                .eq('id', currentUser.id)
                .single();
            
            const { error } = await supabase
                .from('comments')
                .insert({
                    user_id: currentUser.id,
                    username: profile?.username,
                    content: content,
                    section: section,
                    likes: 0
                });
            
            if (error) {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è');
            } else {
                input.value = '';
                loadComments(sectionMap[section]);
            }
        }
        
        async function voteComment(commentId, voteType) {
            if (!currentUser) {
                showAuthModal();
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –≥–æ–ª–æ—Å
            const { data: existingVote } = await supabase
                .from('votes')
                .select('*')
                .eq('user_id', currentUser.id)
                .eq('comment_id', commentId)
                .single();
            
            let finalVote = voteType;
            
            if (existingVote) {
                // –ï—Å–ª–∏ –Ω–∞–∂–∏–º–∞–µ–º —Ç—É –∂–µ –∫–Ω–æ–ø–∫—É - —É–±–∏—Ä–∞–µ–º –≥–æ–ª–æ—Å
                if (existingVote.vote_type === voteType) {
                    finalVote = 0;
                }
                
                await supabase
                    .from('votes')
                    .update({ vote_type: finalVote })
                    .eq('id', existingVote.id);
            } else {
                await supabase
                    .from('votes')
                    .insert({
                        user_id: currentUser.id,
                        comment_id: commentId,
                        vote_type: voteType
                    });
            }
            
            // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –ª–∞–π–∫–∏
            const { data: votes } = await supabase
                .from('votes')
                .select('vote_type')
                .eq('comment_id', commentId);
            
            const total = votes.reduce((sum, v) => sum + (v.vote_type || 0), 0);
            
            await supabase
                .from('comments')
                .update({ likes: total })
                .eq('id', commentId);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
            loadAllComments();
        }
        
        // üìä –û–ü–†–û–°–´
        async function loadPolls() {
            const container = document.getElementById('pollsContainer');
            
            const { data: polls, error } = await supabase
                .from('polls')
                .select('*')
                .eq('is_active', true)
                .order('created_at', { ascending: false });
            
            if (error) {
                container.innerHTML = '<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–ø—Ä–æ—Å–æ–≤</div>';
                return;
            }
            
            if (!polls || polls.length === 0) {
                container.innerHTML = '<p>–û–ø—Ä–æ—Å–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</p>';
                return;
            }
            
            let html = '';
            
            for (const poll of polls) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≥–æ–ª–æ—Å–æ–≤–∞–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
                let userVote = null;
                if (currentUser) {
                    const { data: vote } = await supabase
                        .from('poll_votes')
                        .select('option_index')
                        .eq('user_id', currentUser.id)
                        .eq('poll_id', poll.id)
                        .single();
                    
                    userVote = vote?.option_index;
                }
                
                // –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                const { data: votes } = await supabase
                    .from('poll_votes')
                    .select('option_index')
                    .eq('poll_id', poll.id);
                
                const results = {};
                let total = 0;
                
                poll.options.forEach((_, i) => results[i] = 0);
                votes?.forEach(v => {
                    results[v.option_index]++;
                    total++;
                });
                
                html += `
                    <div class="section" style="margin: 15px 0;">
                        <h3>${escapeHtml(poll.question)}</h3>
                        <p><small>–í—Å–µ–≥–æ –≥–æ–ª–æ—Å–æ–≤: ${total}</small></p>
                `;
                
                poll.options.forEach((option, index) => {
                    const percent = total > 0 ? Math.round((results[index] / total) * 100) : 0;
                    
                    html += `
                        <div class="poll-option ${userVote === index ? 'selected' : ''}"
                             onclick="${!userVote && currentUser ? `votePoll('${poll.id}', ${index})` : ''}"
                             style="${userVote !== null ? 'cursor: default;' : ''}">
                            <div style="display: flex; justify-content: space-between;">
                                <span>${escapeHtml(option)}</span>
                                <span>${percent}% (${results[index]})</span>
                            </div>
                            <div style="background: #444; height: 10px; border-radius: 5px; margin-top: 5px;">
                                <div style="background: #3d85c6; height: 100%; width: ${percent}%; border-radius: 5px;"></div>
                            </div>
                        </div>
                    `;
                });
                
                html += `</div>`;
            }
            
            container.innerHTML = html;
        }
        
        async function votePoll(pollId, optionIndex) {
            if (!currentUser) {
                showAuthModal();
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≥–æ–ª–æ—Å–æ–≤–∞–ª –ª–∏ —É–∂–µ
            const { data: existingVote } = await supabase
                .from('poll_votes')
                .select('*')
                .eq('user_id', currentUser.id)
                .eq('poll_id', pollId)
                .single();
            
            if (existingVote) {
                alert('–í—ã —É–∂–µ –≥–æ–ª–æ—Å–æ–≤–∞–ª–∏ –≤ —ç—Ç–æ–º –æ–ø—Ä–æ—Å–µ');
                return;
            }
            
            await supabase.from('poll_votes').insert({
                user_id: currentUser.id,
                poll_id: pollId,
                option_index: optionIndex
            });
            
            loadPolls();
        }
        
        function createPollModal() {
            if (!currentUser) {
                showAuthModal();
                return;
            }
            
            document.getElementById('pollModal').style.display = 'flex';
            document.getElementById('pollQuestion').value = '';
            document.getElementById('pollOptions').innerHTML = `
                <input type="text" placeholder="–í–∞—Ä–∏–∞–Ω—Ç 1">
                <input type="text" placeholder="–í–∞—Ä–∏–∞–Ω—Ç 2">
            `;
        }
        
        function hidePollModal() {
            document.getElementById('pollModal').style.display = 'none';
        }
        
        function addPollOption() {
            const container = document.getElementById('pollOptions');
            const count = container.children.length;
            
            if (count >= 10) {
                alert('–ú–∞–∫—Å–∏–º—É–º 10 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤');
                return;
            }
            
            const input = document.createElement('input');
            input.type = 'text';
            input.placeholder = `–í–∞—Ä–∏–∞–Ω—Ç ${count + 1}`;
            container.appendChild(input);
        }
        
        async function createPoll() {
            const question = document.getElementById('pollQuestion').value.trim();
            const optionsInputs = document.getElementById('pollOptions').children;
            const errorEl = document.getElementById('pollError');
            
            if (!question) {
                errorEl.textContent = '–í–≤–µ–¥–∏—Ç–µ –≤–æ–ø—Ä–æ—Å';
                errorEl.style.display = 'block';
                return;
            }
            
            const options = [];
            for (let input of optionsInputs) {
                const value = input.value.trim();
                if (value) options.push(value);
            }
            
            if (options.length < 2) {
                errorEl.textContent = '–ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 2 –≤–∞—Ä–∏–∞–Ω—Ç–∞';
                errorEl.style.display = 'block';
                return;
            }
            
            const { error } = await supabase.from('polls').insert({
                question,
                options,
                is_active: true
            });
            
            if (error) {
                errorEl.textContent = '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ–ø—Ä–æ—Å–∞';
                errorEl.style.display = 'block';
            } else {
                hidePollModal();
                loadPolls();
                alert('–û–ø—Ä–æ—Å —Å–æ–∑–¥–∞–Ω!');
            }
        }
        
        // üõ°Ô∏è –≠–ö–†–ê–ù–ò–†–û–í–ê–ù–ò–ï HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // üì± –ê–í–¢–û–†–ê–°–ö–†–´–¢–ò–ï –ü–ï–†–í–û–ô –°–ï–ö–¶–ò–ò
        setTimeout(() => {
            toggleAnswer(1);
        }, 500);
    </script>
</body>
                </html>
