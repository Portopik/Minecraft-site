<!DOCTYPE html>
<html>
<head>
    <title>–ê–≤—Ç–æ—Å—Ç–æ–ø–æ–º –ø–æ –∫—Ä–∞—é - –û–ë–©–ò–ï –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ò</title>
    <meta charset="UTF-8">
    <style>
        /* Minecraft —Å—Ç–∏–ª—å */
        body {
            background: #1a1a1a;
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 15px;
            margin: 0;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        
        header {
            background: linear-gradient(135deg, #5b7c3a, #3b5228);
            border: 5px solid #8b4513;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            margin-bottom: 25px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
        }
        
        h1 {
            color: white;
            margin: 0;
            font-size: 2.2rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
        }
        
        .subtitle {
            color: #d0ffb0;
            margin-top: 10px;
            font-size: 1.1rem;
        }
        
        .card {
            background: #3a2c1d;
            border: 3px solid #654321;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .firebase-status {
            background: #2a2a2a;
            border-left: 5px solid #FFA611;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            text-align: center;
        }
        
        .online {
            border-left-color: #5b7c3a;
            background: rgba(91, 124, 58, 0.1);
        }
        
        .offline {
            border-left-color: #e53e3e;
            background: rgba(229, 62, 62, 0.1);
        }
        
        input, textarea {
            width: 100%;
            padding: 14px;
            margin: 10px 0;
            border: 2px solid #555;
            border-radius: 8px;
            background: #2a2a2a;
            color: white;
            font-size: 16px;
            box-sizing: border-box;
            transition: all 0.3s;
        }
        
        input:focus, textarea:focus {
            outline: none;
            border-color: #5b7c3a;
            box-shadow: 0 0 0 3px rgba(91, 124, 58, 0.3);
        }
        
        button {
            background: #3d85c6;
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
            width: 100%;
            border: 2px solid #1f3d7a;
        }
        
        button:hover {
            background: #2b6cb0;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(43, 108, 176, 0.4);
        }
        
        .firebase-btn {
            background: #FFA611;
            border-color: #cc8500;
        }
        
        .firebase-btn:hover {
            background: #e69500;
        }
        
        .comment {
            background: #3a3a3a;
            padding: 18px;
            margin: 15px 0;
            border-radius: 10px;
            border-left: 5px solid #5b7c3a;
            animation: fadeIn 0.5s ease-out;
            position: relative;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .new-comment {
            border-left-color: #FFA611;
            animation: pulse 1s;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 166, 17, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 166, 17, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 166, 17, 0); }
        }
        
        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .comment-author {
            color: #5b7c3a;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .comment-time {
            color: #888;
            font-size: 0.9rem;
        }
        
        .comment-text {
            line-height: 1.5;
            margin: 10px 0;
            font-size: 1rem;
        }
        
        .comment-actions {
            margin-top: 12px;
            display: flex;
            gap: 15px;
        }
        
        .like-btn {
            background: none;
            border: 2px solid #444;
            padding: 6px 15px;
            border-radius: 20px;
            color: #aaa;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .like-btn:hover {
            border-color: #5b7c3a;
            color: #5b7c3a;
        }
        
        .liked {
            border-color: #5b7c3a;
            background: rgba(91, 124, 58, 0.2);
            color: #5b7c3a;
        }
        
        .refresh-btn {
            background: #5b7c3a;
            border-color: #3b5228;
            margin: 10px 0;
        }
        
        .refresh-btn:hover {
            background: #4a6b2a;
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            text-align: center;
        }
        
        .stat {
            padding: 15px;
            background: #2a2a2a;
            border-radius: 10px;
            flex: 1;
            margin: 0 5px;
        }
        
        .stat-number {
            font-size: 1.8rem;
            font-weight: bold;
            color: #5b7c3a;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #888;
            margin-top: 5px;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 10px;
            }
            
            header {
                padding: 20px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .stats {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <div class="container">
        <!-- –ó–ê–ì–û–õ–û–í–û–ö -->
        <header>
            <h1>üî® –ê–í–¢–û–°–¢–û–ü–û–ú –ü–û –ö–†–ê–Æ ‚öîÔ∏è</h1>
            <div class="subtitle">–û–ë–©–ò–ï –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ò —á–µ—Ä–µ–∑ Firebase</div>
        </header>
        
        <!-- –°–¢–ê–¢–£–° FIREBASE -->
        <div id="firebaseStatus" class="firebase-status">
            <div id="statusText">üöÄ –ü–æ–¥–∫–ª—é—á–∞—é—Å—å –∫ Firebase...</div>
            <div id="statusDetails" style="margin-top: 10px; font-size: 14px; color: #aaa;"></div>
        </div>
        
        <!-- –°–¢–ê–¢–ò–°–¢–ò–ö–ê -->
        <div class="stats">
            <div class="stat">
                <div class="stat-number" id="commentsCount">0</div>
                <div class="stat-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤</div>
            </div>
            <div class="stat">
                <div class="stat-number" id="usersCount">0</div>
                <div class="stat-label">–£—á–∞—Å—Ç–Ω–∏–∫–æ–≤</div>
            </div>
            <div class="stat">
                <div class="stat-number" id="likesCount">0</div>
                <div class="stat-label">–õ–∞–π–∫–æ–≤</div>
            </div>
        </div>
        
        <!-- –§–û–†–ú–ê –î–õ–Ø –ö–û–ú–ú–ï–ù–¢–ê–†–ò–Ø -->
        <div class="card">
            <h3 style="margin-top: 0; color: #d0ffb0;">‚úçÔ∏è –ù–ê–ü–ò–°–ê–¢–¨ –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ô</h3>
            <input type="text" id="username" placeholder="–¢–≤–æ—ë –∏–º—è –≤ Minecraft" value="–ò–≥—Ä–æ–∫">
            <textarea id="comment" placeholder="–¢–≤–æ–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." rows="3"></textarea>
            <button onclick="sendComment()" id="sendBtn">üì§ –û–¢–ü–†–ê–í–ò–¢–¨ –í–°–ï–ú</button>
            <p style="text-align: center; color: #888; margin-top: 15px; font-size: 14px;">
                üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —É–≤–∏–¥—è—Ç –≤—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞
            </p>
        </div>
        
        <!-- –£–ü–†–ê–í–õ–ï–ù–ò–ï -->
        <div style="text-align: center; margin: 20px 0;">
            <button onclick="loadComments()" class="refresh-btn">
                üîÑ –û–ë–ù–û–í–ò–¢–¨ –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ò
            </button>
        </div>
        
        <!-- –°–ü–ò–°–û–ö –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ï–í -->
        <div class="card">
            <h3 style="margin-top: 0; color: #d0ffb0;">üí¨ –ü–û–°–õ–ï–î–ù–ò–ï –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ò</h3>
            <div id="commentsContainer">
                <p style="text-align: center; padding: 40px; color: #888;">
                    –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤...
                </p>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // üî• FIREBASE –ö–û–ù–§–ò–ì (–ì–û–¢–û–í–´–ô!)
        // ============================================
        
        const firebaseConfig = {
            apiKey: "AIzaSyAWg0pxwXm6igXzOY9T9GJ6cDQubmWQzKw",
            authDomain: "minecraft-comments-12345.firebaseapp.com",
            projectId: "minecraft-comments-12345",
            storageBucket: "minecraft-comments-12345.appspot.com",
            messagingBucket: "minecraft-comments-12345.appspot.com",
            messagingSenderId: "1085325486821",
            appId: "1:1085325486821:web:abc123def456789"
        };
        
        // ============================================
        // üì¶ –ü–ï–†–ï–ú–ï–ù–ù–´–ï
        // ============================================
        
        let db = null;
        let isConnected = false;
        let unsubscribe = null;
        let currentUser = null;
        
        // ============================================
        // üöÄ –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
        // ============================================
        
        window.onload = function() {
            initFirebase();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ –∏–º—è
            const savedName = localStorage.getItem('mc_username');
            if(savedName) {
                document.getElementById('username').value = savedName;
                currentUser = savedName;
            }
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å Firebase
        function initFirebase() {
            try {
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Firebase
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                
                updateStatus('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ Firebase!', 'online');
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
                loadComments();
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º —Ä–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
                startRealtimeUpdates();
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
                isConnected = true;
                
            } catch(error) {
                console.error('Firebase error:', error);
                updateStatus(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'offline');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                showLocalData();
            }
        }
        
        // ============================================
        // üí¨ –†–ê–ë–û–¢–ê –° –ö–û–ú–ú–ï–ù–¢–ê–†–ò–Ø–ú–ò
        // ============================================
        
        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
        async function loadComments() {
            if(!isConnected) {
                showLocalData();
                return;
            }
            
            try {
                const snapshot = await db.collection('comments')
                    .orderBy('timestamp', 'desc')
                    .limit(30)
                    .get();
                
                const comments = [];
                let totalLikes = 0;
                const users = new Set();
                
                snapshot.forEach(doc => {
                    const data = doc.data();
                    comments.push({
                        id: doc.id,
                        ...data
                    });
                    
                    totalLikes += (data.likes || 0);
                    users.add(data.user);
                });
                
                displayComments(comments);
                updateStats(comments.length, users.size, totalLikes);
                
            } catch(error) {
                console.error('Load error:', error);
                updateStatus('‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏', 'offline');
                showLocalData();
            }
        }
        
        // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
        async function sendComment() {
            const username = document.getElementById('username').value.trim();
            const commentText = document.getElementById('comment').value.trim();
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∏
            if(!username || !commentText) {
                alert('üìù –ó–∞–ø–æ–ª–Ω–∏ –∏–º—è –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π');
                return;
            }
            
            if(username.length < 2) {
                alert('üë§ –ò–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞');
                return;
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–º—è
            localStorage.setItem('mc_username', username);
            currentUser = username;
            
            const newComment = {
                user: username,
                text: commentText,
                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                time: new Date().toLocaleString('ru-RU'),
                likes: 0,
                userIp: await getClientIP()
            };
            
            const sendBtn = document.getElementById('sendBtn');
            const originalText = sendBtn.textContent;
            sendBtn.textContent = '‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...';
            sendBtn.disabled = true;
            
            try {
                if(isConnected) {
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Firebase
                    await db.collection('comments').add(newComment);
                    
                    // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ
                    document.getElementById('comment').value = '';
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—Ö
                    showNotification('‚úÖ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!');
                    
                } else {
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
                    saveCommentLocal(newComment);
                    showLocalData();
                    showNotification('üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ (Firebase –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω)');
                }
                
            } catch(error) {
                console.error('Send error:', error);
                
                // Fallback –Ω–∞ localStorage
                saveCommentLocal(newComment);
                showLocalData();
                showNotification('‚ö†Ô∏è –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ (–æ—à–∏–±–∫–∞ —Å–µ—Ç–∏)');
            }
            
            sendBtn.textContent = originalText;
            sendBtn.disabled = false;
        }
        
        // –õ–∞–π–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
        async function likeComment(commentId) {
            if(!isConnected) return;
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ª–∞–π–∫–∞–ª –ª–∏ —É–∂–µ
                const likedKey = `liked_${commentId}`;
                if(localStorage.getItem(likedKey)) {
                    alert('–í—ã —É–∂–µ –ª–∞–π–∫–Ω—É–ª–∏ —ç—Ç–æ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π!');
                    return;
                }
                
                const commentRef = db.collection('comments').doc(commentId);
                const doc = await commentRef.get();
                
                if(doc.exists) {
                    const currentLikes = doc.data().likes || 0;
                    await commentRef.update({
                        likes: currentLikes + 1
                    });
                    
                    // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º –ª–∞–π–∫
                    localStorage.setItem(likedKey, 'true');
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
                    const likeBtn = document.querySelector(`[onclick="likeComment('${commentId}')"]`);
                    if(likeBtn) {
                        likeBtn.classList.add('liked');
                        likeBtn.innerHTML = 'üëç <span>' + (currentLikes + 1) + '</span>';
                    }
                }
            } catch(error) {
                console.error('Like error:', error);
            }
        }
        
        // ============================================
        // üé® –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï
        // ============================================
        
        // –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
        function displayComments(comments) {
            const container = document.getElementById('commentsContainer');
            
            if(!comments || comments.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 50px; color: #888;">
                        <p style="font-size: 1.2rem;">üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</p>
                        <p style="margin-top: 10px;">–ë—É–¥—å –ø–µ—Ä–≤—ã–º, –∫—Ç–æ –æ—Å—Ç–∞–≤–∏—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π!</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            comments.forEach(comment => {
                const time = comment.time || 
                    (comment.timestamp ? comment.timestamp.toDate().toLocaleString('ru-RU') : '—Ç–æ–ª—å–∫–æ —á—Ç–æ');
                
                const isLiked = localStorage.getItem(`liked_${comment.id}`) ? 'liked' : '';
                const isNew = Date.now() - comment.timestamp?.toDate?.()?.getTime?.() < 60000;
                
                html += `
                    <div class="comment ${isNew ? 'new-comment' : ''}">
                        <div class="comment-header">
                            <div class="comment-author">${comment.user}</div>
                            <div class="comment-time">${time}</div>
                        </div>
                        <div class="comment-text">${comment.text}</div>
                        <div class="comment-actions">
                            <button onclick="likeComment('${comment.id}')" 
                                    class="like-btn ${isLiked}">
                                üëç <span>${comment.likes || 0}</span>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        function showLocalData() {
            const comments = JSON.parse(localStorage.getItem('local_comments') || '[]');
            
            if(comments.length === 0) {
                // –î–æ–±–∞–≤–ª—è–µ–º –¥–µ–º–æ-–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
                const demoComments = [
                    {
                        id: 'demo1',
                        user: 'MinecraftPro',
                        text: '–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ –¥–µ–º–æ-—Ä–µ–∂–∏–º. –ù–∞—Å—Ç—Ä–æ–π Firebase –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤.',
                        time: new Date().toLocaleString('ru-RU'),
                        likes: 3,
                        timestamp: { toDate: () => new Date() }
                    },
                    {
                        id: 'demo2',
                        user: '–°–∏—Å—Ç–µ–º–∞',
                        text: '–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –±—É–¥—É—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è –º–µ–∂–¥—É –≤—Å–µ–º–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ –ø—Ä–æ–µ–∫—Ç–∞.',
                        time: new Date().toLocaleString('ru-RU'),
                        likes: 2,
                        timestamp: { toDate: () => new Date() }
                    }
                ];
                
                displayComments(demoComments);
                updateStats(demoComments.length, 2, 5);
                
            } else {
                displayComments(comments);
                updateStats(comments.length, 
                    new Set(comments.map(c => c.user)).size,
                    comments.reduce((sum, c) => sum + (c.likes || 0), 0)
                );
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –ª–æ–∫–∞–ª—å–Ω–æ
        function saveCommentLocal(comment) {
            const comments = JSON.parse(localStorage.getItem('local_comments') || '[]');
            comments.unshift({
                id: 'local_' + Date.now(),
                ...comment
            });
            
            if(comments.length > 50) {
                comments.length = 50;
            }
            
            localStorage.setItem('local_comments', JSON.stringify(comments));
        }
        
        // ============================================
        // üîÑ –†–ï–ê–õ–¨–ù–û–ï –í–†–ï–ú–Ø
        // ============================================
        
        // –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
        function startRealtimeUpdates() {
            if(!isConnected || unsubscribe) return;
            
            try {
                unsubscribe = db.collection('comments')
                    .orderBy('timestamp', 'desc')
                    .limit(20)
                    .onSnapshot(snapshot => {
                        const comments = [];
                        let totalLikes = 0;
                        const users = new Set();
                        
                        snapshot.forEach(doc => {
                            const data = doc.data();
                            comments.push({
                                id: doc.id,
                                ...data
                            });
                            
                            totalLikes += (data.likes || 0);
                            users.add(data.user);
                        });
                        
                        displayComments(comments);
                        updateStats(comments.length, users.size, totalLikes);
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–æ–≤—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö
                        if(snapshot.docChanges().some(change => change.type === 'added')) {
                            showNotification('üîÑ –ù–æ–≤—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏!');
                        }
                        
                    }, error => {
                        console.error('Realtime error:', error);
                        updateStatus('‚ö†Ô∏è –û—à–∏–±–∫–∞ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏', 'offline');
                    });
                
            } catch(error) {
                console.error('Start realtime error:', error);
            }
        }
        
        // ============================================
        // üõ†Ô∏è –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
        // ============================================
        
        // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å
        function updateStatus(text, type) {
            const statusEl = document.getElementById('firebaseStatus');
            const textEl = document.getElementById('statusText');
            
            textEl.textContent = text;
            statusEl.className = `firebase-status ${type}`;
            
            // –î–µ—Ç–∞–ª–∏
            const details = document.getElementById('statusDetails');
            if(type === 'online') {
                details.innerHTML = 'üåê –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏';
            } else {
                details.innerHTML = 'üì¥ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ';
            }
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        function updateStats(comments, users, likes) {
            document.getElementById('commentsCount').textContent = comments;
            document.getElementById('usersCount').textContent = users;
            document.getElementById('likesCount').textContent = likes;
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showNotification(text) {
            // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #5b7c3a;
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                z-index: 1000;
                animation: slideIn 0.3s ease-out;
            `;
            
            notification.textContent = text;
            document.body.appendChild(notification);
            
            // –£–¥–∞–ª—è–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-out';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
        }
        
        // –ü–æ–ª—É—á–∏—Ç—å IP –∫–ª–∏–µ–Ω—Ç–∞
        async function getClientIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip.substring(0, 6) + '...'; // –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–Ω—ã–π IP
            } catch {
                return '—Å–∫—Ä—ã—Ç';
            }
        }
        
        // ============================================
        // üéØ –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
        // ============================================
        
        // –≠–∫—Å–ø–æ—Ä—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
        function exportComments() {
            const comments = JSON.parse(localStorage.getItem('local_comments') || '[]');
            const dataStr = JSON.stringify(comments, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const link = document.createElement('a');
            link.setAttribute('href', dataUri);
            link.setAttribute('download', 'minecraft_comments.json');
            document.body.appendChild(link);
            link.click();
            link.remove();
            
            showNotification('üíæ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ JSON');
        }
        
        // –ò–º–ø–æ—Ä—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
        function importComments() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    try {
                        const comments = JSON.parse(event.target.result);
                        localStorage.setItem('local_comments', JSON.stringify(comments));
                        showLocalData();
                        showNotification('üìÅ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!');
                    } catch(error) {
                        alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞: ' + error.message);
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞/–∏–º–ø–æ—Ä—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        setTimeout(() => {
            const controls = document.createElement('div');
            controls.style.cssText = 'text-align: center; margin: 20px 0;';
            controls.innerHTML = `
                <button onclick="exportComments()" style="width: auto; margin: 5px; background: #8b4513;">
                    üíæ –≠–∫—Å–ø–æ—Ä—Ç
                </button>
                <button onclick="importComments()" style="width: auto; margin: 5px; background: #8b4513;">
                    üìÅ –ò–º–ø–æ—Ä—Ç
                </button>
            `;
            
            document.querySelector('.container').appendChild(controls);
        }, 2000);
    </script>
</body>
</html>
